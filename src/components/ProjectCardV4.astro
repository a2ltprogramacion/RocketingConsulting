---
// @src/components/ProjectCardV4.astro (VERSIÓN 4.11 - ANIMACIÓN CORREGIDA)
import type { CollectionEntry } from 'astro:content';
import { mdToHtml } from '../utils/markdown';

export interface Props {
  project: CollectionEntry<'proyectos'>;
}
const { project } = Astro.props;

// Texto de placeholder
const clientName = project.data.client_name ?? "Cliente de Ejemplo";
const titulo = project.data.titulo ?? "Proyecto de Ejemplo";
const summary = project.data.summary;
const image = project.data.image ?? '/assets/uploads/placeholder.jpeg';
---

<a 
  href={`/proyectos/${project.slug}`} 
  class="group relative block overflow-hidden shadow-lg h-80 w-full"
>
  {/* 1. Imagen de Fondo */}
  <img 
    src={image} 
    alt={`Imagen del proyecto ${titulo}`} 
    class="w-full h-full object-cover transition-transform duration-700 ease-in-out group-hover:scale-110" 
  />
  
  {/* 2. Overlay oscuro */}
  <div class="absolute inset-0 bg-black/50 transition-opacity duration-300 group-hover:bg-black/60"></div>

  {/* 3. Contenedor de Contenido (Wrapper)
      - Alineado abajo a la izquierda
      - 'overflow-hidden' es crucial para la animación
  */}
  <div class="absolute bottom-0 left-0 w-full overflow-hidden text-left">

    {/* Contenedor Deslizante (Estado Hover)
        - Contiene TÍTULO + DESCRIPCIÓN
        - Estado Reposo: Abajo (translate-y-full)
        - Estado Hover: Arriba (translate-y-0)
        - Al salir del hover: baja inmediatamente
    */}
    <div class="
      p-4 w-full
      transition-transform ease-out 
      duration-0 group-hover:duration-700
      transform translate-y-full
      group-hover:translate-y-0
    ">
      
      {/* Título (Cliente + Proyecto) */}
      <h3 class="text-lg font-bold text-text-inverted inline-block">
        <span class="bg-accent px-2 py-1 leading-tight">
          {clientName}
        </span>
        <br>
        <span class="bg-accent px-2 py-1 leading-tight mt-1 inline-block">
          {titulo}
        </span>
      </h3>

      {/* Descripción (Summary) */}
      {summary && (
        <div class="mt-2 bg-primary/80 p-2 inline-block">
          <div class="text-sm text-text-inverted">
            <span set:html={mdToHtml(summary)} />
          </div>
        </div>
      )}
    </div>

    {/* Contenedor Fijo (Estado Reposo)
        - Contiene SÓLO TÍTULO
        - Estado Reposo: Visible (opacity-100)
        - Estado Hover: Oculto (opacity-0)
    */}
    <div class="
      absolute bottom-0 left-0
      p-4 w-full 
      transition-opacity duration-0 ease-out
      opacity-100
      group-hover:opacity-0 
    ">
      <h3 class="text-lg font-bold text-text-inverted inline-block">
        <span class="bg-accent px-2 py-1 leading-tight">
          {clientName}
        </span>
        <br>
        <span class="bg-accent px-2 py-1 leading-tight mt-1 inline-block">
          {titulo}
        </span>
      </h3>
    </div>

  </div>
</a>