---
// @src/layouts/Layout.astro
import SeoHead from "../components/atoms/SeoHead.astro";
import "../styles/global.css";

interface Props {
  seo?: {
    site_name: string;
    meta_title: string;
    meta_description: string;
    social_image?: any;
    favicon?: any;
  };
  title?: string;
  description?: string;
}

const { seo, title, description } = Astro.props;

const finalTitle = seo?.meta_title || title || "A2LT V-Card";
const finalDescription =
  seo?.meta_description || description || "Servicios Profesionales";

// --- FIX: Extraer .src del objeto de imagen para SEO ---
const finalImage = seo?.social_image?.src || undefined;

// --- FIX: Extraer .src para el favicon ---
const faviconUrl = seo?.favicon?.src || "/favicon.svg";

const getFaviconType = (url: string) => {
  if (url.endsWith(".svg")) return "image/svg+xml";
  if (url.endsWith(".ico")) return "image/x-icon";
  return "image/png";
};

const faviconType = getFaviconType(faviconUrl);
---

<!doctype html>
<html lang="es" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline' 'unsafe-eval';"
    />

    <SeoHead
      title={finalTitle}
      description={finalDescription}
      image={finalImage}
    />
    <link rel="icon" type={faviconType} href={faviconUrl} />
    <meta
      name="author"
      content="Ing. Angel Argenis LeÃ³n Torres - A2LT Soluciones"
    />
  </head>

  <body
    class="bg-background text-text font-sans antialiased min-h-screen flex flex-col"
  >
    <slot />
    <script is:inline>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", (user) => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
  </body>
</html>
